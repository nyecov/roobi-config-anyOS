# spi_image.xz Explanation

**Filename:** `spi_image.xz`
**Type:** XZ Compressed Binary File
**Context:** This file is used by the `before.sh` script and processed by `fast_flash_spi.py`.

## What is this file?

This is a specific **bootloader firmware image** designed for the SPI (Serial Peripheral Interface) Flash memory chip on the motherboard.

1.  **Content**: It typically contains the **SPL (Secondary Program Loader)** and **U-Boot** binary. These are the very first programs that run when the board is powered on. They initialize the hardware (DRAM, clocks) and are responsible for loading the main operating system kernel.
2.  **Format**: It is compressed using `.xz` (LZMA) compression to save space and reduce download time. Note that the Python script `fast_flash_spi.py` or the system must handle decompression, or `fast_flash_spi.py` might be writing it raw if the boot ROM supports it (though typically one would decompress it first, or the python script handles it - looking at the python script, it reads the file in binary mode. If the file passed is .xz, it writes .xz data to the SPI. **Correction**: The filename in `before.sh` is typically passed as the arg. In the provided `before.sh`, line 9 is `python3 fast_flash_spi.py spi_image.xz /dev/mtdblock0`. This implies `fast_flash_spi.py` allows writing the data directly. **However**, usually SPI requires raw binaries. It is possible the `spi_image.xz` is actually a raw binary named confusingly, OR the system binaries handle it, OR the python script blindly writes compressed data (unlikely to boot), OR there is an implicit decompression step missing in the simple python script analysis. *Self-correction based on standard linux usage*: `fast_flash_spi.py` reads the file as bytes. If the file is XZ compressed, it writes compressed data. Most Rockchip Boot ROMs do NOT boot XZ compressed generic data from SPI. It is highly likely that for the *actual* usage, `spi_image.xz` is either decompressed beforehand or the python script is meant to take the *decompressed* version if the user unzips it. **Wait**, looking at the `download` section of the JSON, the file is downloaded as `spi_image.xz`. The `before.sh` calls `python3 fast_flash_spi.py spi_image.xz ...`. Unless `fast_flash_spi.py` has a hidden decompression lib logic (it uses standard `open(..., 'rb')`), it effectively writes the compressed bytes. This is unusual unless a specific boot stage handles this. **Alternative**: The file named `spi_image.xz` might actually be the raw binary name in the script context, but `roobi` automatically decompresses `.xz` files in the `download` list before placing them on disk? **Yes**, Roobi acts as an installer. If the `file_name` in the JSON is `spi_image.xz`, Roobi might download it. If Roobi handles decompression automatically for `.img.xz`, does it do it for arbitrary files? The JSON says `file_name`: `spi_image.xz`. This suggests the file on disk is XZ compressed.

**Role in Installation:**
The command `python3 fast_flash_spi.py spi_image.xz /dev/mtdblock0` writes this content to `/dev/mtdblock0` (the SPI Flash device). This ensures that the board has the latest compatible bootloader required to boot the specific OS version being installed.
